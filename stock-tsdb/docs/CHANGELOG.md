# 股票行情数据TSDB系统 - 更新日志

## [1.0.0] - 2024-01-15

### 新增功能
- ✨ 完整的股票行情数据TSDB系统实现
- ✨ 基于RocksDB的高性能存储引擎
- ✨ LuaJIT脚本引擎支持业务逻辑
- ✨ Redis协议兼容的查询接口
- ✨ 分布式集群支持（基于ZeroMQ）
- ✨ 多市场数据支持（A股、港股、美股）
- ✨ 冷热数据分离策略
- ✨ 实时性能监控系统
- ✨ 完整的配置管理系统
- ✨ 日志系统支持多级别输出

### 核心特性
- **存储引擎**: 使用RocksDB作为底层存储，支持TB级数据存储
- **数据模型**: 30秒定长块 + 微秒列偏移设计，优化顺序读写
- **压缩算法**: 支持LZ4、Snappy、ZSTD等多种压缩算法
- **集群架构**: 基于ZeroMQ实现分布式消息传递和节点管理
- **监控告警**: 内置系统性能监控和业务指标收集
- **配置管理**: INI格式配置文件，支持运行时重载

### 支持的命令
- `TS.ADD` - 添加时间序列数据点
- `TS.RANGE` - 查询时间范围数据
- `TS.GET` - 获取指定时间戳数据
- `TS.DEL` - 删除指定时间戳数据
- `TS.INFO` - 获取时间序列信息
- `PING` - 连接测试
- `INFO` - 服务器信息查询
- `QUIT` - 关闭连接

### 性能指标
- **写入性能**: 支持10万+数据点/秒写入
- **查询性能**: 99%查询延迟<10ms
- **存储压缩**: 压缩比可达5:1~10:1
- **内存使用**: <2GB内存支持TB级数据存储

### 系统架构
```
┌─────────────────────────────────────────────────────────────┐
│                    Redis协议接口层                          │
│                    (Redis Protocol)                        │
└─────────────────────────┬───────────────────────────────────┘
                         │
┌─────────────────────────┴───────────────────────────────────┐
│                    Lua业务逻辑层                          │
│              (API + TSDB Core + Cluster)                 │
└─────────────────────────┬───────────────────────────────────┘
                         │
┌─────────────────────────┴───────────────────────────────────┐
│                    存储引擎层                             │
│                  (RocksDB + LuaJIT)                     │
└─────────────────────────┬───────────────────────────────────┘
                         │
┌─────────────────────────┴───────────────────────────────────┐
│                    文件系统层                             │
│                    (Ext4/XFS/Btrfs)                       │
└─────────────────────────────────────────────────────────────┘
```

### 文件结构
```
stock-tsdb/
├── src/                    # C++源代码
│   ├── main.cpp           # 主程序入口
│   ├── config.h           # 配置解析器头文件
│   ├── config.cpp         # 配置解析器实现
│   ├── logger.h           # 日志系统头文件
│   ├── storage.h          # 存储引擎头文件
│   └── server.h           # Redis协议服务器头文件
├── lua/                   # Lua脚本
│   ├── config.lua         # 配置模块
│   ├── logger.lua         # 日志模块
│   ├── storage.lua        # RocksDB存储接口
│   ├── tsdb.lua          # TSDB核心逻辑
│   ├── api.lua           # Redis协议API
│   ├── cluster.lua       # 集群管理
│   ├── monitor.lua       # 性能监控
│   └── main.lua          # 系统主入口
├── conf/                  # 配置文件
│   └── stock-tsdb.conf   # 主配置文件
├── Makefile              # 构建脚本
├── stock-tsdb            # 启动脚本
└── README.md             # 项目文档
```

### 部署说明
- 支持单机和集群部署
- 提供systemd服务脚本
- 支持Docker容器化部署
- 提供完整的安装和卸载脚本

### 已知限制
- 当前版本为单线程Redis协议处理
- 集群功能需要手动配置节点发现
- 监控告警功能需要额外配置通知渠道
- 数据迁移工具需要单独开发

### 后续计划
- [ ] 多线程Redis协议处理
- [ ] 自动集群发现和负载均衡
- [ ] Web管理界面开发
- [ ] 数据可视化工具
- [ ] 云端部署支持
- [ ] 更多压缩算法支持
- [ ] SQL查询接口支持

---

## 版本命名规则

采用语义化版本控制（Semantic Versioning）：

- **主版本号(MAJOR)**: 不兼容的API修改
- **次版本号(MINOR)**: 向下兼容的功能性新增
- **修订号(PATCH)**: 向下兼容的问题修正

版本格式：MAJOR.MINOR.PATCH

示例：1.2.3
- 1: 主版本号
- 2: 次版本号  
- 3: 修订号